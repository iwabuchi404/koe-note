# E2Eテスト実行ガイド

## テスト用音声ファイルについて

### ファイル配置
- テスト用音声ファイル: `tests/e2e/testdata/recording_test.webm`
- このファイルを使用して実際の文字起こし機能をテストします

### テストファイルの要件
- **形式**: WebM（アプリでサポートされている形式）
- **長さ**: 5-30秒程度（テスト実行時間を考慮）
- **内容**: 明瞭な日本語音声（文字起こし結果の検証のため）
- **サイズ**: 1MB以下推奨

## テスト実行方法

### 1. 事前準備
```bash
# 依存関係のインストール
npm install

# アプリケーションのビルド
npm run build

# Whisperサーバーが起動していることを確認
# (文字起こしテストに必要)
```

### 2. E2Eテスト実行

#### 全テスト実行
```bash
npm run test:e2e
```

#### UIモードでの実行（推奨）
```bash
npm run test:e2e:ui
```

#### 特定のテストファイルのみ実行
```bash
# 録音機能のテスト
npx playwright test recording.spec.ts

# 文字起こし機能のテスト
npx playwright test transcription.spec.ts
```

### 3. ヘッドレスモードでの実行
```bash
npx playwright test --headed
```

## テスト内容

### 録音機能テスト (`recording.spec.ts`)
- ✅ 録音ボタンの動作確認
- ✅ 録音開始→停止フロー
- ✅ 一時停止・再開機能
- ✅ エラーハンドリング
- ✅ **録音済み音声ファイルの再生テスト**（追加）

### 文字起こし機能テスト (`transcription.spec.ts`)
- ✅ **テスト用音声ファイルでの実際の文字起こし**（更新）
- ✅ 処理進捗の表示確認
- ✅ エラーハンドリング
- ✅ 設定の適用確認
- ✅ ファイル形式の検証

## 重要な更新点

### 🎵 実際の音声ファイルを使用
従来のモックテストから、実際の音声ファイル `recording_test.webm` を使用したテストに更新しました。

### 🎯 テスト可能な範囲
- **ファイル選択**: 実際のファイルを選択
- **音声再生**: HTMLAudioElementを使用した再生
- **文字起こし処理**: Whisperサーバーへの実際のリクエスト
- **UI反応**: 処理中の状態表示、結果表示

### ❌ テスト制限事項
- **実際の録音**: ブラウザ環境では音声入力のシミュレーションが困難
- **マイクアクセス**: テスト環境でのハードウェア依存
- **音声品質**: 実際の音質評価は手動テストが必要

## トラブルシューティング

### Whisperサーバー接続エラー
```bash
# Whisperサーバーが起動していない場合
# サーバーを起動してからテストを実行
```

### ファイルパスエラー
```bash
# テスト用音声ファイルが存在することを確認
ls tests/e2e/testdata/recording_test.webm
```

### タイムアウトエラー
- 文字起こし処理は時間がかかる場合があります
- テストのタイムアウト値は60秒に設定済み
- 必要に応じて `playwright.config.ts` で調整可能

## CI/CD環境での実行

### GitHub Actionsなど
- ヘッドレスモードでの実行推奨
- Whisperサーバーのモック化が必要な場合があります
- 音声ファイルをリポジトリに含めるかCI環境で生成

### ローカル開発環境
- UIモードでの実行でデバッグが容易
- 実際のサーバーを使用した完全なテスト可能